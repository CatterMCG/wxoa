标题： 开发技术 | 日志是多么重要的东西啊

### 背景

开发的同学都知道日志是多么重要的东西，日志的应用场景主要有两个：数据统计（告警和视图） 和 问题定位。后期数据统计还能用来性能优化，通过 **问题定位** 才是需要长期重点关注的问题。

网页上有很多的关于log的介绍的文字，大多都是偏于日志框架的应用介绍 以及很简单的一些常见规范的说明。本篇文字主要专注于 进入公司的新同学该从哪些角度快速熟悉日志功能，提高我们定位问题的能力。

#### 惨痛案例

刚来两个月不到的时候，有一次业务开发，有两个需求同时需要上sit环境 第二天要上uat，很着急。由于dev环境数据问题没能完全测试，项目在sit上挂了，一直找不到原因。当时晚上八点钟，两个需求的几个人都在我旁边等着我解决问题，项目到我这里阻塞了。后来还是在导师的帮助下看日志文件才解决了问题。而对于我来说，当时对项目里面日志的内容一点都不熟悉，要完全由我解决问题的话估计得30min，可是导师5min看出了问题。

刚来的那段时间，我一直在看框架、写小的业务和各种文档，感觉自己一堆东西要学习，就是没重视项目日志学习。后来我全面总结了日志相关内容，加上对业务深入，也能够很快定位问题了。

### 关于log的一些思考

本篇文章不讲我们用的什么日志框架，如何进行日志采集、日志监控、日志告警等知识，主要介绍一下我觉得日志学习的三步曲：

- 项目中的日志学习，要特别注意哪些内容
- 日志打印的好习惯
- 日志查看常见方法

#### 项目中的日志学习，要特别注意哪些内容

1. **了解日志打印规范**：梳理一下项目中不同场景下日志打印的规律 就会知道公司开发的习惯了，也要慢慢形成自己的习惯。
   - 场景：数据库操作、业务逻辑还是接口请求
   - 级别：INFO ERROR DEBUG
   - 内容：打印关键词 关键性内容或标志
2. **熟记每个环境下日志存放地址**：开发者需要熟知每个测试环境和生产环境的日志存放地址，方便快速查看日志文件。或者至少你知道在哪配置日志目录地址，可以临时去查找。一般不同环境下日志地址配置是一致的。
3. **熟知拦截器中日志打印的内容**：每个公司一定会在拦截器中做一些日志处理的操作，这些日志会按照统一的规则进行打印的，会打印一些关键信息比如用来串连一次请求的traceid/userid、接口名等

#### 日志打印的好习惯

1. **服务启动的时候 记得打印日志**：记录一些服务启动的关键信息，可以包括输出一些初始化信息、ip和端口、服务状态等
2. **用拦截器对每个接口的请求进行输出**：比如打印traceId/userId/requestId、接口名、返回（正常返回 和 error）
3. **巧用关键字**：在业务中打印一点关键信息，能够帮助自己快速定位问题。
4. **注意不同日志级别的使用场景**：有时候发生error了 但是不需要打印error。日志的统计可以推动开发者减少日志量，错误日志量也是程序稳定性的一个衡量标准。

#### 日志查看常见方法

在日志查看的时候，使用一些技巧可以提高查询效率，帮助我们快速定位问题：

- **动态查看日志**：通过下面的命令可以打开日志，当调用一个请求时会动态输出日志，**方便服务器调试**。

```
tailf logfile
```

- **常用日志查看操作**：一般以下4步就可以定位问题。然后判断报错是自己代码问题，还是配置问题，还是上下游协作问题。

```
1. vi logfile     //vim 打开日志文件
2. shift+g 	      //快捷方式 将光标移至尾行
3. /requestId  //在vim模式下，输入 /requestId ,可查询关键字 requestId
4. 按 N 可以查看下一个
//输入 ：1?XXXX  可以从后往前查看 XXXX 关键字
```

- **查找关键字在文件中出现的内容**：

```
grep XXX logfile
```

所以最后反问一下自己：如果出现一个问题 我们能够快速定位问题吗？是业务不熟悉还是无法快速定位？日志文件在哪里？关键字是什么？报错是什么？是代码问题、配置问题、上下游协作的问题还是其他人业务问题？

可能有时候我们没有这么夸张的遇到问题，但是遇到问题如何快速定位是我们必备的能力，特别是在一个新的环境，当然确实工作时间久了 对各种问题都是很敏感。机会是留给有准备的人，想承担更多必须了解的更多。